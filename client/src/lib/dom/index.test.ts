import { DomManipulator } from '$lib/dom'
import {it, expect} from 'vitest';

it('getDomElementFromHTML returns a DOM element', () => {
  const htmlString = '<div id="test"></div>'
  const element = DomManipulator.getDomElementFromHTML(htmlString)
  expect(element).not.toBeNull()
  expect(element?.nodeName).toBe('DIV')
  expect((element as HTMLElement).id).toBe('test')
})

it('addChildToDomElement appends a child to a parent node', () => {
  const parentHTML = '<div id="parent"></div>'
  const childHTML = '<p id="child">Hello</p>'
  let parent = DomManipulator.getDomElementFromHTML(parentHTML)
  const child = DomManipulator.getDomElementFromHTML(childHTML)
  parent = DomManipulator.addChildToDomElement(parent!, child!)
  expect((parent as HTMLElement).innerHTML).toContain(childHTML)
})


it('minimize CSS', () => {
  const html = '<a href="https://stackoverflow.co/teams/" class="s-btn fs-body2 bar-md bg-blue-500 h:bg-blue-600 fc-white d:fc-black-900 p-ff-source-bold w100 wmx2 fs-body2 px32 w100 wmx2 fs-body2 px32" data-ga="[&quot;home page&quot;,&quot;header cta&quot;,&quot;Request a demo&quot;,null,null]" id="clicked-element" style="">Discover Teams</a>'
  const css = '#clicked-element{animation-range-start:normal;animation-timeline:auto;animation-timing-function:ease;app-region:none;appearance:none;backdrop-filter:none;backface-visibility:visible;background-attachment:scroll;background-blend-mode:normal;background-clip:border-box;background-color:#0074cc;background-image:none;background-origin:padding-box;background-position:0 0;background-repeat:repeat;background-size:auto;baseline-shift:0;baseline-source:auto;block-size:43.3047px;border-block-end-color:transparent;border-block-end-style:solid;border-block-end-width:1px;border-block-start-color:transparent;border-block-start-style:solid;border-block-start-width:1px;border-bottom-color:transparent;border-bottom-left-radius:6px;border-bottom-right-radius:6px;border-bottom-style:solid;border-bottom-width:1px;border-collapse:separate;border-end-end-radius:6px;border-end-start-radius:6px;border-image-outset:0;border-image-repeat:stretch;border-image-slice:100%;border-image-source:none;border-image-width:1;border-inline-end-color:transparent;border-inline-end-style:solid;border-inline-end-width:1px;border-inline-start-color:transparent;border-inline-start-style:solid;border-inline-start-width:1px;border-left-color:transparent;border-left-style:solid;border-left-width:1px;border-right-color:transparent;border-right-style:solid;border-right-width:1px;border-start-end-radius:6px;border-start-start-radius:6px;border-top-color:transparent;border-top-left-radius:6px;border-top-right-radius:6px;border-top-style:solid;border-top-width:1px;bottom:0;box-shadow:rgba(0,116,204,.15) 0 0 0 4px;box-sizing:border-box;break-after:auto;break-before:auto;break-inside:auto;buffered-rendering:auto;caption-side:top;caret-color:#fff;clear:none;clip:auto;clip-path:none;clip-rule:nonzero;color:#fff;color-interpolation:srgb;color-interpolation-filters:linearrgb;color-rendering:auto;column-count:auto;column-gap:normal;column-rule-color:#fff;column-rule-style:none;column-rule-width:0;column-span:none;column-width:auto;contain-intrinsic-block-size:none;contain-intrinsic-height:none;contain-intrinsic-inline-size:none;contain-intrinsic-size:none;contain-intrinsic-width:none;container-name:none;container-type:normal;content:normal;cursor:pointer;direction:ltr;display:inline-block;dominant-baseline:auto;empty-cells:show;fill:#000;fill-opacity:1;fill-rule:nonzero;filter:none;flex-basis:auto;flex-direction:row;flex-grow:0;flex-shrink:1;flex-wrap:nowrap;float:none;flood-color:#000;flood-opacity:1;font-family:"Source Sans Pro Bold",sans-serif;font-kerning:auto;font-optical-sizing:auto;font-palette:normal;font-size:15px;font-stretch:100%;font-style:normal;font-synthesis-small-caps:auto;font-synthesis-style:auto;font-synthesis-weight:auto;font-variant:normal;font-variant-alternates:normal;font-variant-caps:normal;font-variant-east-asian:normal;font-variant-ligatures:normal;font-variant-numeric:normal;font-weight:700;grid-auto-columns:auto;grid-auto-flow:row;grid-auto-rows:auto;grid-column-end:auto;grid-column-start:auto;grid-row-end:auto;grid-row-start:auto;grid-template-areas:none;grid-template-columns:none;grid-template-rows:none;height:43.3047px;hyphenate-character:auto;hyphenate-limit-chars:auto;hyphens:manual;image-orientation:from-image;image-rendering:auto;initial-letter:normal;inline-size:210.664px;inset-block-end:0;inset-block-start:0;inset-inline-end:0;inset-inline-start:0;isolation:auto;justify-content:normal;justify-items:normal;justify-self:auto;left:0;letter-spacing:normal;lighting-color:#fff;line-break:auto;line-height:17.3077px;list-style-image:none;list-style-position:outside;list-style-type:disc;margin-block-end:0;margin-block-start:0;margin-bottom:0;margin-inline-end:0;margin-inline-start:0;margin-left:0;margin-right:0;margin-top:0;marker-end:none;marker-mid:none;marker-start:none;mask-type:luminance;math-depth:0;math-shift:normal;math-style:normal;max-block-size:none;max-height:none;max-inline-size:210.667px;max-width:210.667px;min-block-size:0;min-height:0;min-inline-size:0;min-width:0;mix-blend-mode:normal;object-fit:fill;object-position:50% 50%;object-view-box:none;offset-distance:0;offset-path:none;offset-rotate:auto 0deg;opacity:1;order:0;orphans:2;outline-color:#fff;outline-offset:0;outline-style:none;outline-width:0;overflow-anchor:auto;overflow-clip-margin:0;overflow-wrap:normal;overflow-x:visible;overflow-y:visible;overscroll-behavior-block:auto;overscroll-behavior-inline:auto;padding-block-end:12px;padding-block-start:12px;padding-bottom:12px;padding-inline-end:32px;padding-inline-start:32px;padding-left:32px;padding-right:32px;padding-top:12px;paint-order:normal;perspective:none;perspective-origin:105.328px 21.6484px;pointer-events:auto;position:relative;resize:none;right:0;rotate:none;row-gap:normal;ruby-position:over;scale:none;scroll-behavior:auto;scroll-margin-block-end:0;scroll-margin-block-start:0;scroll-margin-inline-end:0;scroll-margin-inline-start:0;scroll-padding-block-end:auto;scroll-padding-block-start:auto;scroll-padding-inline-end:auto;scroll-padding-inline-start:auto;scroll-timeline-axis:block;scroll-timeline-name:none;scrollbar-gutter:auto;shape-image-threshold:0;shape-margin:0;shape-outside:none;shape-rendering:auto;speak:normal;stop-color:#000;stop-opacity:1;stroke:none;stroke-dasharray:none;stroke-dashoffset:0;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-opacity:1;stroke-width:1px;tab-size:4;table-layout:auto;text-align:center;text-align-last:auto;text-anchor:start;text-decoration:none solid #fff;text-decoration-color:#fff;text-decoration-line:none;text-decoration-skip-ink:auto;text-decoration-style:solid;text-emphasis-color:#fff;text-emphasis-position:over;text-emphasis-style:none;text-indent:0;text-overflow:clip;text-rendering:auto;text-shadow:none;text-size-adjust:100%;text-transform:none;text-underline-position:auto;text-wrap:wrap;top:0;touch-action:auto;transform:none;transform-origin:105.332px 21.6523px;transform-style:flat;transition-delay:0s;transition-duration:0s;transition-property:all;transition-timing-function:ease;translate:none;unicode-bidi:normal;user-select:none;vector-effect:none;vertical-align:baseline;view-timeline-axis:block;view-timeline-inset:0;view-timeline-name:none;view-transition-name:none;visibility:visible;white-space-collapse:collapse;widows:2;width:210.664px;will-change:auto;word-break:normal;word-spacing:0;writing-mode:horizontal-tb;z-index:auto;zoom:1;-webkit-border-horizontal-spacing:0;-webkit-border-image:none;-webkit-border-vertical-spacing:0;-webkit-box-align:stretch;-webkit-box-decoration-break:slice;-webkit-box-direction:normal;-webkit-box-flex:0;-webkit-box-ordinal-group:1;-webkit-box-orient:horizontal;-webkit-box-pack:start;-webkit-box-reflect:none;-webkit-font-smoothing:antialiased;-webkit-highlight:none;-webkit-line-break:auto;-webkit-line-clamp:none;-webkit-locale:en;-webkit-mask-box-image:none;-webkit-mask-box-image-outset:0;-webkit-mask-box-image-repeat:stretch;-webkit-mask-box-image-slice:0 fill;-webkit-mask-box-image-source:none;-webkit-mask-box-image-width:auto;-webkit-mask-clip:border-box;-webkit-mask-composite:source-over;-webkit-mask-image:none;-webkit-mask-origin:border-box;-webkit-mask-position:0 0;-webkit-mask-repeat:repeat;-webkit-mask-size:auto;-webkit-print-color-adjust:economy}'
  const result = DomManipulator.minimizeCss(html, css)
  expect(result)
})